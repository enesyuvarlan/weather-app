"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../external/@babel/runtime/helpers/esm/classCallCheck.js"),t=require("../../external/@babel/runtime/helpers/esm/createClass.js"),r=require("../../external/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=require("../../external/@babel/runtime/helpers/esm/inherits.js"),o=require("../../external/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),n=require("../../external/@babel/runtime/helpers/esm/getPrototypeOf.js"),s=require("../../external/@babel/runtime/helpers/esm/defineProperty.js"),a=require("react"),c=require("classnames"),i=require("../../utility/react/react.js"),u=require("../../utility/mocks/mocks.js"),p=require("./Scrollable.utils.js"),f=require("../../tools/ResizeObserver/ResizeObserver.js"),d=require("./components/VerticalScrollbar/VerticalScrollbar.js"),h=require("./components/VerticalScrollbar/VerticalScrollbar.placeholder.js"),m=require("./components/HorizontalScrollbar/HorizontalScrollbar.js"),b=require("./components/HorizontalScrollbar/HorizontalScrollbar.placeholder.js");require("./components/Shadow/Shadow.js");var y=require("./Scrollable.context.js"),v=require("./Scrollable.props.js"),S=require("./Scrollable.constants.js");function j(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("./Scrollable2.js");var O=j(a),g=j(c);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,l)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){s.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,l=n.default(e);if(t){var s=n.default(this).constructor;r=Reflect.construct(l,arguments,s)}else r=l.apply(this,arguments);return o.default(this,r)}}var E=function(o){l.default(a,o);var n=T(a);function a(t){var l;return e.default(this,a),l=n.call(this,t),s.default(r.default(l),"handleOnScroll",(function(e){var t=l.container.current;l.updateScrollbars(),l.props.onScroll(l.event.next),e.target===t&&(t.parentElement.classList.add("scrolling"),clearTimeout(l.timeout),l.timeout=setTimeout((function(){t.parentElement.classList.remove("scrolling")}),S.SCROLLING_CLASS_REMOVAL_DELAY))})),s.default(r.default(l),"getEvent",(function(){var e=l.container.current;if(!e)return{};var t=e.clientHeight,r=e.clientWidth,o=e.scrollTop,n=e.scrollLeft,s=e.scrollHeight,a=e.scrollWidth,c=Math.ceil(o),i=Math.ceil(n);return{top:p.normalizeScrollPosition(s,t,c),left:p.normalizeScrollPosition(a,r,i),scrollTop:c,scrollLeft:i,scrollHeight:s,scrollWidth:a,clientHeight:t,clientWidth:r}})),s.default(r.default(l),"updateScrollbars",(function(){var e=l.event.next=l.getEvent();if(l.shouldUpdateScrollbars(l.event)&&l.container.current){l.props.onUpdate(e);var t=l.container.current.parentElement,r=e.clientHeight/e.scrollHeight,o=e.clientWidth/e.scrollWidth;u.requestAnimationFrame((function(){t.classList.toggle("vertically-scrollable",r<1),t.classList.toggle("horizontally-scrollable",o<1),t.style.setProperty(S.CSS_VARS.verticalRatio,r),t.style.setProperty(S.CSS_VARS.horizontalRatio,o),l.setState((function(t){return q(q({},t),{},{scrollTop:e.top,scrollLeft:e.left})})),l.props.cssVarsOnTracks||(t.style.setProperty(S.CSS_VARS.scrollTop,e.top),t.style.setProperty(S.CSS_VARS.scrollLeft,e.left))}))}l.event.prev=e})),s.default(r.default(l),"getElementProps",(function(){var e=l.props.element;return{className:g.default("scrollbar-inner",e.props.className),ref:i.copyComponentRef(e.ref,l.container),onScroll:l.handleOnScroll}})),s.default(r.default(l),"handleOnTransitionEnd",(function(e){["height","width"].includes(e.propertyName)&&l.updateScrollbars()})),l.container=O.default.createRef(),l.event={prev:{},next:{}},l.state={cssVarsOnTracks:t.cssVarsOnTracks,scrollTop:0,scrollLeft:0,container:l.container},l}return t.default(a,[{key:"getSnapshotBeforeUpdate",value:function(){var e=this.container.current;return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}}},{key:"componentDidMount",value:function(){this.updateScrollbars()}},{key:"componentDidUpdate",value:function(e,t,r){var l=r.scrollTop,o=r.scrollLeft;this.props.scrollOnDOMChange||(this.container.current.scrollTop=l,this.container.current.scrollLeft=o),this.updateScrollbars()}},{key:"shouldUpdateScrollbars",value:function(e){var t=e.next,r=e.prev;return t.clientHeight!==r.clientHeight||t.scrollHeight!==r.scrollHeight||t.clientWidth!==r.clientWidth||t.scrollWidth!==r.scrollWidth||t.top!==r.top||t.left!==r.left}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.style,l=e.element,o=i.findChildByType(t,h.default),n=i.findChildByType(t,b.default),s=O.default.Children.toArray(t).filter((function(e){return![h.default,b.default].includes(e.type)}));return O.default.createElement(f.default,{onResize:this.updateScrollbars},O.default.createElement("div",{className:"scrollbar",style:r,onTransitionEnd:this.handleOnTransitionEnd},O.default.cloneElement(l,this.getElementProps(),s),O.default.createElement(y.default.Provider,{value:this.state},o?o.props.children:O.default.createElement(d.default,null),n?n.props.children:O.default.createElement(m.default,null))))}}]),a}(O.default.PureComponent);s.default(E,"propTypes",v.propTypes),s.default(E,"defaultProps",v.defaultProps),exports.default=E;
