import e from"../../external/@babel/runtime/helpers/esm/classCallCheck.es.js";import t from"../../external/@babel/runtime/helpers/esm/createClass.es.js";import r from"../../external/@babel/runtime/helpers/esm/assertThisInitialized.es.js";import o from"../../external/@babel/runtime/helpers/esm/inherits.es.js";import l from"../../external/@babel/runtime/helpers/esm/possibleConstructorReturn.es.js";import n from"../../external/@babel/runtime/helpers/esm/getPrototypeOf.es.js";import s from"../../external/@babel/runtime/helpers/esm/defineProperty.es.js";import c from"react";import i from"classnames";import{copyComponentRef as a,findChildByType as p}from"../../utility/react/react.es.js";import{requestAnimationFrame as u}from"../../utility/mocks/mocks.es.js";import{normalizeScrollPosition as m}from"./Scrollable.utils.es.js";import f from"../../tools/ResizeObserver/ResizeObserver.es.js";import h from"./components/VerticalScrollbar/VerticalScrollbar.es.js";import d from"./components/VerticalScrollbar/VerticalScrollbar.placeholder.es.js";import b from"./components/HorizontalScrollbar/HorizontalScrollbar.es.js";import v from"./components/HorizontalScrollbar/HorizontalScrollbar.placeholder.es.js";import"./components/Shadow/Shadow.es.js";import y from"./Scrollable.context.es.js";import{propTypes as g,defaultProps as j}from"./Scrollable.props.es.js";import{SCROLLING_CLASS_REMOVAL_DELAY as S,CSS_VARS as O}from"./Scrollable.constants.es.js";import"./Scrollable.es2.js";function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=n(e);if(t){var s=n(this).constructor;r=Reflect.construct(o,arguments,s)}else r=o.apply(this,arguments);return l(this,r)}}var H=function(l){o(g,l);var n=E(g);function g(t){var o;return e(this,g),o=n.call(this,t),s(r(o),"handleOnScroll",(function(e){var t=o.container.current;o.updateScrollbars(),o.props.onScroll(o.event.next),e.target===t&&(t.parentElement.classList.add("scrolling"),clearTimeout(o.timeout),o.timeout=setTimeout((function(){t.parentElement.classList.remove("scrolling")}),S))})),s(r(o),"getEvent",(function(){var e=o.container.current;if(!e)return{};var t=e.clientHeight,r=e.clientWidth,l=e.scrollTop,n=e.scrollLeft,s=e.scrollHeight,c=e.scrollWidth,i=Math.ceil(l),a=Math.ceil(n);return{top:m(s,t,i),left:m(c,r,a),scrollTop:i,scrollLeft:a,scrollHeight:s,scrollWidth:c,clientHeight:t,clientWidth:r}})),s(r(o),"updateScrollbars",(function(){var e=o.event.next=o.getEvent();if(o.shouldUpdateScrollbars(o.event)&&o.container.current){o.props.onUpdate(e);var t=o.container.current.parentElement,r=e.clientHeight/e.scrollHeight,l=e.clientWidth/e.scrollWidth;u((function(){t.classList.toggle("vertically-scrollable",r<1),t.classList.toggle("horizontally-scrollable",l<1),t.style.setProperty(O.verticalRatio,r),t.style.setProperty(O.horizontalRatio,l),o.setState((function(t){return T(T({},t),{},{scrollTop:e.top,scrollLeft:e.left})})),o.props.cssVarsOnTracks||(t.style.setProperty(O.scrollTop,e.top),t.style.setProperty(O.scrollLeft,e.left))}))}o.event.prev=e})),s(r(o),"getElementProps",(function(){var e=o.props.element;return{className:i("scrollbar-inner",e.props.className),ref:a(e.ref,o.container),onScroll:o.handleOnScroll}})),s(r(o),"handleOnTransitionEnd",(function(e){["height","width"].includes(e.propertyName)&&o.updateScrollbars()})),o.container=c.createRef(),o.event={prev:{},next:{}},o.state={cssVarsOnTracks:t.cssVarsOnTracks,scrollTop:0,scrollLeft:0,container:o.container},o}return t(g,[{key:"getSnapshotBeforeUpdate",value:function(){var e=this.container.current;return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}}},{key:"componentDidMount",value:function(){this.updateScrollbars()}},{key:"componentDidUpdate",value:function(e,t,r){var o=r.scrollTop,l=r.scrollLeft;this.props.scrollOnDOMChange||(this.container.current.scrollTop=o,this.container.current.scrollLeft=l),this.updateScrollbars()}},{key:"shouldUpdateScrollbars",value:function(e){var t=e.next,r=e.prev;return t.clientHeight!==r.clientHeight||t.scrollHeight!==r.scrollHeight||t.clientWidth!==r.clientWidth||t.scrollWidth!==r.scrollWidth||t.top!==r.top||t.left!==r.left}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.style,o=e.element,l=p(t,d),n=p(t,v),s=c.Children.toArray(t).filter((function(e){return![d,v].includes(e.type)}));return c.createElement(f,{onResize:this.updateScrollbars},c.createElement("div",{className:"scrollbar",style:r,onTransitionEnd:this.handleOnTransitionEnd},c.cloneElement(o,this.getElementProps(),s),c.createElement(y.Provider,{value:this.state},l?l.props.children:c.createElement(h,null),n?n.props.children:c.createElement(b,null))))}}]),g}(c.PureComponent);s(H,"propTypes",g),s(H,"defaultProps",j);export{H as default};
